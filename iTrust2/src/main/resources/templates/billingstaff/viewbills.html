<html xmlns:th="http://www.thymeleaf.org">

<head th:include="layout :: head(title=~{::title},links=~{::script})">
<title>View Bills</title>
<script th:src="@{/js/dateTimeService.js}"
	src="../../../js/dateTimeService.js"></script>

</head>

<body th:include="layout :: body" th:with="content=~{::content}">
	<div th:fragment="content">


		<script th:inline="javascript">
      /* Otherwise Thymeleaf tries to parse Javascript as XML and breaks itself sometimes.  Sigh */
      /*<![CDATA[*/
      var app = angular.module("viewBillsApp", ['dateTimeServices', 'jkAngularRatingStars']);

	  /**
	   * A filter to humanize the text to be more user friendly.
	   */
	  app.filter('humanize', function() {
		  return function (input) {

			  if (input == null || input == "") {
			  	return "";
			  }

			  return input.toLowerCase().split('_')
					  .map((word) => word.charAt(0).toUpperCase() + word.substring(1))
					  .join(' ');
		  }
	  });

      app.controller('viewOfficeVisitsCtrl', function ($scope, $http, dateTimeService) {
    	  
    	  $scope.bills = [];
          $scope.pattern = /^\d{4}-\d{4}-\d{2}$/;
          $scope.loadTable = function () {
            $http.get("/iTrust2/api/v1/bills/").then(
              function (response) {
                $scope.bills = response.data;
                $scope.message = "";
              }, function (rejection) {
                $scope.bills = [];
                $scope.message = "Could not display bills";
              });
          }
          $scope.loadTable();


	  });
			/*]]>*/
    </script>

		<div ng-app="viewOfficeVisitsApp" ng-controller="viewOfficeVisitsCtrl">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<div class="panel panel-primary">
							<div class="panel-heading">
								<h3>View Bills</h3>
							</div>
							<div class="panel-body">
								<table class="table table-bordered">
									<caption>Patients:</caption>

									<thead>
										<tr>
											<th></th>
											<th>First</th>
											<th>Last</th>
										</tr>
									</thead>
									<tbody>
										<tr name="officeVisitsTableRow" ng-repeat="p in patients "
											visitId={{v.id}}>
											<td name="selectCell"><input type="radio"
												name="selectRow" ng-model="$parent.selectedPatient"
												ng-value="v.id" ng-click="selectPatient(p)"></td>
											<td name="dateCell">{{p.firstName}}</td>
											<td name="providerCell">{{p.lastName}}</td>

										</tr>
									</tbody>
								</table>

								<!-- Error Messages -->
								<div class="row">

									<div class="col-md-12 text-right">
										<div style="white-space: pre-line;">
											<div name="errorMsg" class="text-danger">{{errorMsg}}</div>
										</div>
									</div>
								</div>

							</div>

							<div class="panel-footer text-right">
								<!-- button may have to be inside form tag, or just a submit function for the form? -->

								<button class="btn btn-primary btn-lg"
									ng-click="viewSelectedVisit()" name="viewVisit"
									ng-disabled="!visit">View Details</button>
							</div>

						</div>


						<!-- Display the information about the selected visit -->
						<div class='panel panel-default'
							ng-if="visit && (display || displaySurvey)">

							<!-- Show correct heading based on what button was pressed -->
							<div class="panel-heading" ng-show="display">
								<h3>Selected Visit Details</h3>
							</div>

							<div class="panel-heading" ng-show="displaySurvey">
								<h3>Satisfaction Survey</h3>
							</div>

							<div class='panel-body'>

								<div ng-if="display" class="row">

									<div class="panel panel-info">
										<div class="panel-heading">
											<h4>Office Visits</h4>
										</div>
										<div class="panel-body">
											<div class="form-group row" ng-repeat="v in temp">
												<div class="col-xs-12 radio-box">
													<div class="form-check">
														<input type="radio" name="visitradio"
															ng-click="selectVisit(v)">
														<ul>
															<span>
																HCP name: {{v.hcp.username}}
																</span> <br> 
															<span> 
																Hospital name: {{v.hospital.name}} </span> <br>
																<span>
																 Visit date: {{v.date | date :
																"MM.dd.yy"}} </span> <br>
																<span>
															   Total cost of visit: ${{v.total}} </span> <br>
																<span>
															    Bill
																status: {{v.billStatus}}</span>
														</ul>

													</div>
												</div>
											</div>
											<div class='input-form'>

												Enter payment type (cash, credit card, insurance etc) <input
													type="text" ng-model="paymentType"> <br>
												Enter amount if paying partially <input type="number"
													ng-model="partial"> <br>
												Enter Date of Payment (Should be in MM/DD/YYYY ) <input
													type="text" ng-model="date"> <br>

												<button class="btn btn-primary btn-lg" ng-click="payFull(date, paymentType)"
													name="viewVisit">Pay Full</button>

												<button class="btn btn-primary btn-lg"
													ng-click="payPartially(date, partial, paymentType)" name="viewVisit">Pay
													Partially</button>
												<br>
												<span ng-show="more"> Payment amount cannot be more than total </span>
												<span ng-show="required"> Payment type is required </span>
											</div>


										</div>
									</div>
								</div>



							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>